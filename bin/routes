#!/usr/bin/env php
<?php

use App\Core\Application;
use Dotenv\Dotenv;
use jc21\CliTable;

require_once __DIR__ . "/../vendor/autoload.php";
Dotenv::createImmutable(__DIR__ . "/../")->load();

$config = [
    "db" => [
        "dsn" => $_ENV["DB_DSN"],
        "user" => $_ENV["DB_USER"],
        "password" => $_ENV["DB_PASSWORD"]
    ]
];

/** @var Application $app */
$app = require_once dirname(__DIR__) . "/src/start/routes.php";
$routes = $app->router->routes;
$saveRoutes = [];

foreach ($routes as $key => $route) {
    foreach ($route as $k => $r) {
        $c = explode("\\", $r[0]);
        $arr = [
            "route" => $k,
            "method" => $key,
            "controller" => is_array($r) ? end($c) : "-",
            "function" => is_array($r) ? $r[1] : "-",
            "view" => !is_array($r) ? $r : "-"
        ];
        array_push($saveRoutes, $arr);
    }
}

$table = new CliTable();
$table->setTableColor('blue');
$table->setHeaderColor('cyan');
$table->addField('Route', 'route', false, 'white');
$table->addField('Method', 'method', false, 'grey');
$table->addField('Controller', 'controller', false, "white");
$table->addField('Function', 'function', false, "white");
$table->addField('View', 'view', false, "white");
$table->injectData($saveRoutes);
$table->display();